<html>
    <head>
        <!-- Define root for all REST api requests -->
        <script type=text/javascript>
            $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
        </script>
        <!-- Load JQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"/></script>
        <script>window.jQuery || document.write('<script src="{{
url_for('static', filename='jquery-2.1.4.min.js') }}">\x3C/script>')</script>

        <script>
            function updateTable() {
                $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT + "/_viewusertable"
                }).done(function(data) {
                    alert (JSON.stringify(data))
                    $("#usertable").html("");
                    var html = "<table><thead><tr><th>User</th><th>FoodtableId</th></tr></thead><tbody>";
                    for (var i=0, len = data.rows.length; i < len; ++i) {
                        html += "<tr>";
                        for (var j=0, rowLen = data.rows[i].length; j < rowLen; ++j) {
                            html+="<td>" + data.rows[i][j] + "</td>";
                        }
                        html += "</tr>";
                    }

                    html += "</tbody></table>";
                    $(html).appendTo("#usertable");

                    
                });
            }
            $( document ).ready(function() {
                /* Bind AJAX call to add user button */
                $( "#add" ).bind("click",(function(e) {
                    e.preventDefault();
                    var userid = document.getElementById("name").value;
                    var formData = new FormData(this);
                    $.ajax({
                        type: "POST",
                        url: $SCRIPT_ROOT + "/_adduser",
                        data: {"user_id" : userid}
                    }).done(function(output) {
                        updateTable();
                    }).fail(function(jqXHR, textStatus) {
                        alert(jqXHR.status);
                        alert(textStatus);
                        alert(jqXHR.responseText);
                    });
                }))
                /* Display table using AJAX call */
                updateTable();
            })
        </script>
    </head>
    <body>
        <div id="usertable">
        </div>
        <input id="name" type="text" value="User ID"/>
        <input id="add" type="button" value="Add user"/>
    </body>
</html>
